"""
Django settings for my_project project.

Generated by 'django-admin startproject' using Django 3.1.5.

For more information on this file, see
https://docs.djangoproject.com/en/3.1/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/3.1/ref/settings/
"""

import os
from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent
LOGGER_ROOT = os.path.join(BASE_DIR, 'logger')
# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/3.1/howto/deployment/checklist/

APP_NAME = "my_app"
PROJECT_NAME = "my_project"
STATIC_NAME = "my_static"
# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = '&8ue%+g+nyf8oy6ctogjia!q$o_qv@^sr44&px*63_k!=^$192'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = ['*']

# Application definition

INSTALLED_APPS = [
    'daphne',
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'django_apscheduler',
    'django.contrib.gis',
    # é¡¹ç›®å·¥ç¨‹
    APP_NAME,
    # rest frameworkæ¡†æ¶
    'rest_framework',
    'rest_framework_gis',
    # è¿‡æ»¤å™¨
    'django_filters',
    # èº«ä»½è®¤è¯
    'rest_framework.authtoken',
    # swaggeræ–‡æ¡£
    'rest_framework_swagger',
    # è·¨åŸŸ
    'corsheaders',
    'channels'
    # 'sslserver',
    # 'werkzeug_debugger_runserver',
    # 'django_extensions'

]
# AUTH_USER_MODEL = "{}.SysUser".format(APP_NAME)

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'corsheaders.middleware.CorsMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    '{}.middleware.DisableCSRF'.format(APP_NAME),
    '{}.middleware.CORSMiddleware'.format(APP_NAME),
    '{}.middleware.EncryptionMiddleware'.format(APP_NAME)

]

# # SECURITYå®‰å…¨è®¾ç½® - æ”¯æŒhttpæ—¶å»ºè®®å¼€å¯
# SECURE_PROXY_SSL_HEADER = ("HTTP_X_FORWARDED_PROTO", "https")
# # SECURE_SSL_REDIRECT = True # å°†æ‰€æœ‰éSSLè¯·æ±‚æ°¸ä¹…é‡å®šå‘åˆ°SSL
# SESSION_COOKIE_SECURE = True  # ä»…é€šè¿‡httpsä¼ è¾“cookie
# CSRF_COOKIE_SECURE = True  # ä»…é€šè¿‡httpsä¼ è¾“cookie
# SECURE_HSTS_INCLUDE_SUBDOMAINS = True  # ä¸¥æ ¼è¦æ±‚ä½¿ç”¨httpsåè®®ä¼ è¾“
# SECURE_HSTS_PRELOAD = True  # HSTSä¸º
# SECURE_HSTS_SECONDS = 60
# SECURE_CONTENT_TYPE_NOSNIFF = True  # é˜²æ­¢æµè§ˆå™¨çŒœæµ‹èµ„äº§çš„å†…å®¹ç±»å‹

# è·¨åŸŸå¢åŠ å¿½ç•¥
CORS_ALLOW_CREDENTIALS = True
CORS_ORIGIN_ALLOW_ALL = True
# CORS_ORIGIN_WHITELIST = (
#     '*'
# )

CORS_ALLOW_METHODS = (
    'DELETE',
    'GET',
    'OPTIONS',
    'PATCH',
    'POST',
    'PUT',
    'VIEW',
)

CORS_ALLOW_HEADERS = (
    'XMLHttpRequest',
    'X_FILENAME',
    'accept-encoding',
    'authorization',
    'content-type',
    'dnt',
    'origin',
    'user-agent',
    'x-csrftoken',
    'x-requested-with',
    'Pragma',
)

REST_FRAMEWORK = {
    # Use Django's standard `django.contrib.auth` permissions,
    # or allow read-only access for unauthenticated users.
    # èº«ä»½è®¤è¯
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework.authentication.BasicAuthentication',
        'rest_framework.authentication.SessionAuthentication',
        '{}.token.ExpiringTokenAuthentication'.format(PROJECT_NAME)  # è‡ªå®šä¹‰tokenè®¤è¯ï¼Œå¢åŠ äº†tokenå¤±æ•ˆæ—¶é—´
        # 'rest_framework.authentication.TokenAuthentication',  # tokenè®¤è¯
    ),
    # æƒé™è®¤è¯
    'DEFAULT_PERMISSION_CLASSES': (
        'rest_framework.permissions.IsAuthenticated',  # IsAuthenticated ä»…é€šè¿‡è®¤è¯çš„ç”¨æˆ·
        'rest_framework.permissions.AllowAny',  # AllowAny å…è®¸æ‰€æœ‰ç”¨æˆ·
        'rest_framework.permissions.IsAdminUser',  # IsAdminUser ä»…ç®¡ç†å‘˜ç”¨æˆ·
        'rest_framework.permissions.IsAuthenticatedOrReadOnly',  # IsAuthenticatedOrReadOnly è®¤è¯çš„ç”¨æˆ·å¯ä»¥å®Œå…¨æ“ä½œï¼Œå¦åˆ™åªèƒ½getè¯»å–
    ),
    # è¿‡æ»¤å™¨
    'DEFAULT_FILTER_BACKENDS': (
        'django_filters.rest_framework.DjangoFilterBackend', 'rest_framework.filters.OrderingFilter'),
    # åˆ†é¡µ
    # 'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    # åˆ†é¡µ
    'DEFAULT_PAGINATION_CLASS': 'my_project.customPageNumberPagination.CustomPageNumberPagination',
    'PAGE_SIZE': 10,  # æ¯é¡µæ•°ç›®
    #  swaggeræ–‡æ¡£
    'DEFAULT_SCHEMA_CLASS': 'rest_framework.schemas.AutoSchema',

}

ROOT_URLCONF = '{}.urls'.format(PROJECT_NAME)

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [os.path.join(BASE_DIR, "templates")],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
            'libraries': {  # Adding this section should work around the issue.
                'staticfiles': 'django.templatetags.static',
            },
        },
    },
]

WSGI_APPLICATION = '{}.wsgi.application'.format(PROJECT_NAME)
ASGI_APPLICATION = '{}.asgi.application'.format(PROJECT_NAME)
# æŒ‡å®šæ—¥å¿—çš„ç›®å½•æ‰€åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º
LOG_ROOT = os.path.join(BASE_DIR, 'log')
if not os.path.exists(LOG_ROOT):
    os.mkdir(LOG_ROOT)

# æ—¥å¿—é…ç½®ï¼ˆåŸºæœ¬è·ŸåŸç”Ÿçš„TimedRotatingFileHandlerä¸€æ ·ï¼‰
LOGGING = {
    'version': 1,
    'disable_existing_loggers': True,
    'formatters': {
        'standard': {
            'format': '[%(asctime)s] [%(filename)s:%(lineno)d] [%(module)s:%(funcName)s] '
                      '[%(levelname)s]- %(message)s'},
        'simple': {  # ç®€å•æ ¼å¼
            'format': '%(levelname)s %(message)s'
        },
    },
    'handlers': {
        'servers': {
            'class': '{}.log.InterceptTimedRotatingFileHandler'.format(PROJECT_NAME),  # è¿™ä¸ªè·¯å¾„çœ‹ä½ æœ¬åœ°æ”¾åœ¨å“ªé‡Œ(ä¸‹é¢çš„logæ–‡ä»¶)
            # è·¯å¾„å¯ä»¥è®¾ç½®åœ¨å¤–éƒ¨ï¼Œå¹¶åŒæ­¥åˆ°å®¿ä¸»æœº
            'filename': os.path.join(LOG_ROOT, 'myapp.log'),
            # æ¯å¤©è‡ªåŠ¨å½’æ¡£å†™æ–°çš„æ—¥å¿—æ–‡ä»¶
            'when': "D",
            'interval': 1,
            'backupCount': 1,
            'formatter': 'standard',
            'encoding': 'utf-8',
        },
        'db': {
            'class': '{}.log.InterceptTimedRotatingFileHandler'.format(PROJECT_NAME),  # è¿™ä¸ªè·¯å¾„çœ‹ä½ æœ¬åœ°æ”¾åœ¨å“ªé‡Œ
            'filename': os.path.join(LOG_ROOT, 'myapp_db.log'),ã€
            # æ¯å¤©è‡ªåŠ¨å½’æ¡£å†™æ–°çš„æ—¥å¿—æ–‡ä»¶
            'when': "D",
            'interval': 1,
            'backupCount': 1,
            'formatter': 'standard',
            'encoding': 'utf-8',
            'logging_levels': ['info']  # ğŸ˜’æ³¨æ„è¿™é‡Œï¼Œè¿™æ˜¯è‡ªå®šä¹‰ç±»å¤šäº†ä¸€ä¸ªå‚æ•°ï¼Œå› ä¸ºæˆ‘åªæƒ³è®©dbæ—¥å¿—æœ‰debugæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘åªçœ‹sqlï¼Œè¿™ä¸ªå¯ä»¥è‡ªå·±è®¾ç½®
        }
    },
    'loggers': {
        # Djangoå…¨å±€ç»‘å®š
        'django': {
            'handlers': ['servers'],
            'propagate': True,
            'level': "INFO"
        },
        'celery': {
            'handlers': ['servers'],
            'propagate': False,
            'level': "INFO"
        },
        'django.db.backends': {
            'handlers': ['db'],
            'propagate': False,
            'level': "DEBUG"
        },
        'django.request': {
            'handlers': ['servers'],
            'propagate': False,
            'level': "DEBUG"
        },
    }
}

CHANNEL_LAYERS = {
    "default": {
        "BACKEND": "channels_redis.core.RedisChannelLayer",
        "CONFIG": {
            "hosts": [("192.168.3.191", 6379)],
        },
    },
}

# Redisç¼“å­˜åº“é…ç½®
CACHES = {
    "default": {
        "BACKEND": "django_redis.cache.RedisCache",
        "LOCATION": "redis://192.168.3.191:6379/0",
        "OPTIONS": {
            "CLIENT_CLASS": "django_redis.client.DefaultClient",
            "COMPRESSOR": "django_redis.compressors.zlib.ZlibCompressor",
            "CONNECTION_POOL_KWARGS": {"max_connections": 512},
            "IGNORE_EXCEPTIONS": True,
            "SOCKET_CONNECT_TIMEOUT": 5,  # in seconds
            "SOCKET_TIMEOUT": 5,  # in seconds
        }
    }
}

# Database
# https://docs.djangoproject.com/en/3.1/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.contrib.gis.db.backends.postgis',
        # 'ENGINE': 'django.db.backends.postgresql_psycopg2',
        'USER': 'postgres',
        'PASSWORD': '*******',
        'HOST': '192.168.3.191',
        'PORT': '5432',
        'NAME': 'DZ_AREA'
    }
}

# Password validation
# https://docs.djangoproject.com/en/3.1/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]

# Internationalization
# https://docs.djangoproject.com/en/3.1/topics/i18n/

# è®¾ç½®ä¸ºä¸­æ–‡
LANGUAGE_CODE = 'zh-Hans'

TIME_ZONE = 'Asia/Shanghai'

USE_I18N = True

USE_L10N = True
# ä¸ç”¨ä¸–ç•Œæ—¶
USE_TZ = False

# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/3.1/howto/static-files/


STATICFILES_DIRS = [os.path.join(BASE_DIR, '{}/{}'.format(APP_NAME, STATIC_NAME))]

# æ ¹æ®é¡¹ç›®åç§°ä¿®æ”¹url
STATIC_URL = '/{}/'.format(STATIC_NAME)

# STATIC_ROOT = os.path.join(BASE_DIR, '{}'.format(APP_NAME), '{}'.format(STATIC_NAME))

# ä¸Šä¼ æ–‡ä»¶ç›®å½•
UPLOAD_ROOT = os.path.join(BASE_DIR, '{}'.format(APP_NAME), '{}'.format(STATIC_NAME), 'upload')

# æ˜¯å¦ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
IS_USE_MOCK_DATA = False

# tokenå¤±æ•ˆæ—¶é—´ï¼Œå•ä½ç§’ï¼Œå¼€å‘å¯è‡ªè¡Œé…ç½®
AUTH_TOKEN_AGE = 60 * 60 * 3

# é¡¹ç›®éƒ¨ç½²çš„IPã€ç«¯å£å·ã€ç½‘ç»œåè®®
PROJECT_WEB_PROTOCOL = 'http'
PROJECT_SERVICE_IP = '192.168.3.152'
# ç”¨nginxä»£ç†å‡ºæ¥å®ç°åç«¯è·¨åŸŸçš„ç«¯å£
PROJECT_SERVICE_PORT = '10841'

# å¹¿è¥¿æœåŠ¡å™¨
# PROJECT_SERVICE_IP = '117.141.148.176'
# PROJECT_SERVICE_PORT = '14001'

# æ˜¯å¦å¼€å¯éªŒè¯ç 
IS_USE_VERIFICATION_CODE = False

# æ˜¯å¦å¯¹è¯·æ±‚å“åº”åšåŠ è§£å¯†
IS_ENCRYPTION = False

# ç™»å½•å¤±è´¥å°è¯•æ¬¡æ•°
LOGIN_ERROR_ATTEMPTS = 4

# è´¦å·é”å®šåçš„è§£é”æ—¶é—´ï¼Œå•ä½ç§’
LOGIN_LOCKED_TIME = 10 * 60

# Tokençš„key
TOKEN_KEY = 'Authorization'

# åŠ å¯†ç›¸å…³ä¿¡æ¯
ENCRPTION = {
    "key1": "uNl-LfGm6NKDQ1Uz9azZIEEzYnaLz68gz0UzaQvYFIY=",
    "key2": "Z0FBQUFBQmsyZWJGZl81NGRMVG9zTVdtQmhTalhfQkhvRVlaVElCMm1ubnZHTXFOb1otNG40ODFlX1JDNk5udmZQaWxrTTI4ODNsVjZyYVZNZDZUZ3NnbS0wMGpEVE1JZFVWS3pkU0pkWVpWcG1ZaTRoeHJDQTd1UXo1Mk5tZ19sdlZUUC1HZ0xiUkNKYWFhcVNuaTFMcTZSam96b3liZmNfMUtKYUxUdldkM3lyVngtYUZleE0zVEZ1cHlkTGdFRVlOQkhlR2dkT191VjJOWXFWSF9YamNuZkE1cURJTlpmWWpUZS1ON2lDZmlNX1MzSzk4eVFEQ2E1MHFTMUpCYjJVRVhrX2pDaEIwcnhVb3lvQ3hqRWF5aTJNVFYwamNtamxyYzFlMXFjaFpDVDBCZkhQdTFma1kwVV93dVNFamlpNUY1ejZIWG1VNEhfMGh0N1hrYXNfcnBobzZ5X1RtVXRiOUtWelZPTFpsNmVxc2xqUHdGYkswPQ==",
    "key3": "Z0FBQUFBQmsyZWJGOWxzeWtGZnVwa0tNdFBQSG1GSkxfRXZPS2lScmtMSHBZM0w4M3FJdXY1N0JHTlRwYjFILXY0akl0NjVvSFA0bkdWdENtTUx6czFab3AwQkpoQ1VNeXJ2QUFTMU9NZ200ZzlVMWZWdTU3eWt0WjhnaElZVzN3WUxZTzFZMkF6czhFN19JWk9zZmRsSDRBdzZuUUVQQW5VbFJpZ1oxVVdlVkVNWEJkSVdGX0VVNEZrRDUtQVFrQm9zalphRkxzLVBGanlnTEhUb0VPaE5YYnBaeDJaUm1laHRUOUxNamIycFMyMDlnYkJ0NTFpZVZxaElkZXlUcEQ5eUJBUTZBVkNkVHI5UktVeFJDMjlXNlhaVWNEZnNlZ09ZWE42Nk52eG9lWnNWOURVRVV4SVFGaGNVM2tuOVBiTHFyQzJOTzNFMUpMendYdWF4ZzBPWnBfc1RXWGxNMnJiNWxsRzQ0Uk12RF85NTR0U2I5SzdQSXc2c1c3N0w2T1cteTNPcWZhdHM0SHlYdXllbkc5ZG04V25TbHdrMC0xRHBXVktQTW1TT3pFMmZsZkNReDczanphYXlxNnpmaE5Db1k0ejBpNVo5N1owM0M4UVNJUWZNUmFSZVctQklaeG5LZE90amNTNHlCU1lzY1B6ZGlfRVczRk05T09udG14OWlSaXZWVnh0dmtwLXJvZUU1MFl4WjBRX0lIaUJhZF9RNTB2a2VYeUtaMmhmY2xTRWtJNFVBX0dHMnNKOGhYRF82bVJDa2Jfck5CeVhIU3BOQW82QmJwZjdXVUhZSEMxSGEwaUk3a0pwS3BoSDRoMDhkblNYVVlyQWV3QWVFSFdIZ1IydE5yeWRwd1ZtR1h6MXJsS28wWWZ6VWtUZzlWZG1nQjE3M1JOQUVvcjg4NThzczZmazg0Tmp6SjNzZXNCanpIek5YRnp0YXZhbFdhWDNYMV9NYXJFMExtZXdYLXhsZ3k2T3g5YlduV1hJRFEzbFVsTDhRYWZ0WFZNTEo3dlFyTHFKREV0ZWxJYnJKN3RRZmt3cE9Bc3F5TlZ3WVg4YTY4VW5MbnZuVkhudllTQ052S3ZwSWx5c2tuX1FuZ1F6ejAyTVZrUG5meTU2c2NSbWs2ZDlDUVA5QXdMLU9Sc3FqVVF6RXB0UG9YNkZSTnRreXZIR05qRW9JQkp4MmU2amw5YlhqZzl2RlFYS0lIck9HU3hHS185em1qLTY1UnV3eDl5SGFyT1lpV1REY3NsMzhEOEh1NFlHMHkwNlpWdWpuTGFVemtTSGFLZmZZWE02ZE1HcGxjRC1nR2NPb0Q3S0FjdXlpNEJjRWlER2h0X1VQR1VuZ0YwNEpzWVZvbmxDaXBSQ0dwSHBYTDBwZ1AycjFSd1pibndFRW41UjNtQzVIczVzYzgyQjdWZ2VlMm5kbnNVN1FqTlVHWHdoRGR2QUVXWGZnZFRRZVlNRk1xZHNGcVVCcEw3RmRsaVUtM29aZHZycV93cXByR291T0dxWnhBVF9VS0FaNjJJb29XOEhpbzBKa2JXbGJBY1Q3VFZGd1BqSGp3LVpaR0p5NGlwZUZfREV0dUNZSG90bnRQU3hPOUxweURyTlB4X3l6VHZRdDFGejREbVQ1QQ==",
    "key4": "b3sVBbMdxJ2pgK/XYPpKVEYdVNk8bUBt9bcpCMegEec3m/nfbvdvVgPlEm1Yd6aavB8jdUR1HF1vf13l/ADVddg6Cl1Yl+vXkDaKeKHa7bHoJpLAWt7i0mIVHSMhPJdQb2qRTbaPCu8MRZNsJWivgnnTSGEHy+vvGhvxCeWcmB0="
}

# è®¸å¯æ–‡ä»¶çš„è·¯å¾„
WINDOWS_LICENSE_PATH = "E:/license/django_license.lic"
LINUX_LICENSE_PATH = "/home/root/license/django_license.lic"

# å¤šçº¿ç¨‹æ•°
MAX_THREAD_COUNT = 16
